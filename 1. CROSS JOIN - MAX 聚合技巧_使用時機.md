# CROSS JOIN - MAX 聚合技巧使用指南

當您遇到以下情況時，可以考慮使用 CROSS JOIN - MAX 聚合技巧：

## 1. 數據粒度不一致
- 您需要在同一查詢中處理不同粒度的數據。
- 例如：需要將細粒度的數據（如每個主題的瀏覽量）與粗粒度的數據（如整體用戶數）進行比較或計算。

## 2. 需要計算比例或百分比
- 您的查詢目標是計算某個群組在整體中的佔比。
- 分子和分母來自不同的數據源或不同的聚合級別。

## 3. 避免複雜子查詢
- 您想避免使用多層嵌套的子查詢，以提高查詢的可讀性和效能。
- 傳統方法可能需要多個子查詢，而 CROSS JOIN - MAX 可以在一個查詢中完成。

## 4. 動態分母
- 分母值不是固定的，而是需要根據某些條件動態計算。
- 例如：根據不同的用戶類型（TA/non-TA）使用不同的總數作為分母。

## 5. 多維度分析
- 您需要在多個維度上進行比較或計算。
- 每個維度可能有自己的總計或基準值。

## 6. 需要靈活的條件選擇
- 您的查詢需要根據不同的條件選擇不同的值進行計算。
- MAX(CASE WHEN ...) 結構提供了這種靈活性。

## 7. 數據轉換與重組
- 您需要將行數據轉換為列數據，或者需要重新組織數據的結構。
- CROSS JOIN 可以幫助創建所有可能的組合，而 MAX 可以選擇所需的組合。

## 8. 效能考慮
- 當其他方法（如多個 JOIN 或子查詢）可能導致效能問題時。
- CROSS JOIN - MAX 技巧在某些情況下可能提供更好的查詢效能。

## 注意事項
- 確保 CROSS JOIN 不會產生過大的中間結果集，以免影響效能。
- 考慮數據量和查詢頻率，確保這種方法適合您的使用場景。
- 在大型數據集上使用時，可能需要優化或考慮其他方法。
